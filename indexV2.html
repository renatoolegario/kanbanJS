<!DOCTYPE html>
<html>
<head>
    <style>
        .kanban-board {
            display: flex;
        }
        .column {
            flex: 1;
            margin: 10px;
            padding: 10px;
            border: 1px solid #ccc;
            background-color: #f9f9f9;
        }
        .card {
            margin: 10px;
            padding: 10px;
            border: 1px solid #333;
            background-color: #fff;
            cursor: grab;
            display: flex;
            flex-direction: column;
        }
        .column-title {
            font-weight: bold;
        }
        .move-button {
            background-color: #007bff;
            color: #fff;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
        }
        .card-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 10px;
            border-top: 1px solid #ccc;
        }
    </style>
</head>
<body>

	
	<div id="addContatosKanban" style="position: absolute; border: 1px solid black; width: 20%; margin-left: 40%; border-radius: 10%; z-index: 999; background-color: rgba(255, 255, 255);margin-top:5%;">
		<div style="margin: 5%;">
			<span id="tituloAddContato"></span>
			<input type="hidden" id="nColunaKanban" value="">
			<span>Telefone de contato</span><br>
			<input type="text" id="telefoneAdd" style="width: 90%;"><br>
			<span>Nome do contato</span>
			<input type="text" id="nomeAdd" style="width: 90%;"><br>
			<span>Descrição do atendimento</span>
			<textarea id="descricaoAdd" style="width: 90%; height: 150px;"></textarea><br>
			<button onclick="addContKanban();">Adicionar</button>
			<button onclick="fecharAddC();">Fechar</button>
		</div>
	</div>



    <div class="kanban-board">
        <div class="column" id="kanbanC1" ondrop="drop(event, 'kanbanC1')" ondragover="allowDrop(event)">
		<table>
			<tr>
				<td>
					 <h2 class="column-title">
						<input type="text" id="titleC1" value="kanbanC1" oninput="changeTitle('titleC1')">
					</h2>
				
				</td>
				
				<td>					
					<button  onclick="addC(1);"> + </button>					
				</td>
			
			</tr>
		
		</table>
           
        </div>
        <div class="column" id="kanbanC2" ondrop="drop(event, 'kanbanC2')" ondragover="allowDrop(event)">
            <h2 class "column-title">
                <input type="text" id="titleC2" value="kanbanC2" oninput="changeTitle('titleC2')">
            </h2>
        </div>
        <div class="column" id="kanbanC3" ondrop="drop(event, 'kanbanC3')" ondragover="allowDrop(event)">
            <h2 class "column-title">
                <input type="text" id="titleC3" value="kanbanC3" oninput="changeTitle('titleC3')">
            </h2>
        </div>
        <div class="column" id="kanbanC4" ondrop="drop(event, 'kanbanC4')" ondragover="allowDrop(event)">
            <h2 class="column-title">
                <input type="text" id="titleC4" value="kanbanC4" oninput="changeTitle('titleC4')">
            </h2>
        </div>
        <div class="column" id="kanbanC5" ondrop="drop(event, 'kanbanC5')" ondragover="allowDrop(event)">
            <h2 class="column-title">
                <input type="text" id="titleC5" value="kanbanC5" oninput="changeTitle('titleC5')">
            </h2>
        </div>
    </div>

    <script>
		
		function addContKanban(){
			
				var nColuna = document.getElementById('nColunaKanban').value;
				var telefone = document.getElementById('telefoneAdd').value;
				var nome = document.getElementById('nomeAdd').value;
				var descricao = document.getElementById('descricaoAdd').value;
				var timestampAtual = new Date().getTime();
				var timestampAtualEmSegundos = Math.floor(timestampAtual / 1000);
				
				var cardInfo = [
					id = timestampAtualEmSegundos, // Nome da coluna + card1
					foto = "", // card.foto (variável vazia)
					nome = nome, // card.nome
					telefone = telefone, // card.telefone
					descricao = descricao, // card.descricao
					status = "", // card.status (variável vazia)
					entradaC1 = "", 
					entradaC2 = "", 
					entradaC3 = "", 
					entradaC4 = "", 
					entradaC5 = ""					
				];
				
				var kanban = localStore.getItem
					
			
			fecharAddC();
		}
	
		function fecharAddC(){
		
			const addContatosKanban = document.getElementById('addContatosKanban');
				addContatosKanban.style.display = "none";
				addContatosKanban.style.zIndex = "-10";
				
				document.getElementById('nColunaKanban').value = "";
				document.getElementById('telefoneAdd').value = "";
				document.getElementById('nomeAdd').value = "";
				document.getElementById('descricaoAdd').value = "";
		
		}
		
		function addC(n){
			
			let kanban = 'kanbanC' + n;
			document.getElementById('nColunaKanban').value = kanban;
			kanban = localStorage.getItem(kanban)
			const columnData = JSON.parse(kanban);
			console.log(columnData.nome);
			
			
			const addContatosKanban = document.getElementById('addContatosKanban');
				addContatosKanban.style.display = "";
				addContatosKanban.style.zIndex = "999";
				
				
		
		}
	
        // Função para verificar e criar as colunas no localStorage
        function verificarColunasNoLocalStorage() {
		
			for(i= 1; i <= 5; i++){
                var columnId = "kanbanC" + i;
                var columnData = localStorage.getItem(columnId);
                var titleColum = "titleC" + i;

                if (!columnData) {
                    // Se a coluna não existe no localStorage, crie-a com valores padrão
                    var columnName = columnId;
                    var message = {
                        idImagem: "imagem123",
                        idMensagem: "mensagem456"
                    };
                    var cards = [];
					

                    var columnData = {
                        nome: columnName, // Adicione o nome da coluna aqui
                        mensagem: message,
                        cartoes: cards
                    };

                    // Armazene a nova coluna no localStorage
                    localStorage.setItem(columnId, JSON.stringify(columnData));
                } 
            }      
        }

        // Chame a função para verificar e criar as colunas no localStorage na carga inicial da página
        verificarColunasNoLocalStorage();

        function allowDrop(event) {
            event.preventDefault();
        }

        function drag(event) {
            event.dataTransfer.setData("text", event.target.id);
        }

        function drop(event, targetColumn) {
            event.preventDefault();
            var data = event.dataTransfer.getData("text");
            var target = document.getElementById(targetColumn);
            if (target.classList.contains("column")) {
                target.appendChild(document.getElementById(data));

                // Atualizar o localStorage com as informações da coluna
				let columnAntigo = data.slice(0, 8);
				let cardId = data.slice(8,100);
                updateColumnStorage(targetColumn,columnAntigo,cardId);
            }
        }

        function changeTitle(titleId) {
            var titleInput = document.getElementById(titleId);
            var columnId = titleId.replace("title", "kanban");
            var newTitle = titleInput.value;

            // Recupere os dados atuais da coluna no localStorage
            var columnData = localStorage.getItem(columnId);

            if (columnData) {
                // Parse dos dados existentes
                columnData = JSON.parse(columnData);

                // Atualize apenas o nome
                columnData.nome = newTitle;

                // Guarde os dados atualizados novamente no localStorage
                localStorage.setItem(columnId, JSON.stringify(columnData));
            }
        }

  
  
  
  
  function updateColumnStorage(colunaAtual, columnAntigo, cardId) {
	
	console.log("Esta puxando aqui: Coluna atual: " + colunaAtual + " | Coluna Antiga: " + columnAntigo + " | ID : " + cardId);

	// Entrar dentro do ColumAntigo e capturar todo o array do cardId.
	
	let dadosCardId = localStorage.getItem(columnAntigo);
	
	console.log(dadosCardId);

	// Adicionar este cardId no colunaAtual e remover do antigo Colum Antigo
	
	
	
  
}

  
  
  
        // Recuperar informações do localStorage para preencher o kanban
        for (var i = 1; i <= 5; i++) {
            var columnId = "kanbanC" + i;
            var columnData = localStorage.getItem(columnId);
            if (columnData) {
                columnData = JSON.parse(columnData);
                document.getElementById("title" + columnId).value = columnData.nome;
                // Você pode preencher a mensagem automática e os cartões com os dados armazenados.
            }
        }

        // Adicione cartões ao painel com botão de movimentação e informações
        function createCard(cardId, foto, nome, telefone, descricao, status, dataEntrada, dataEntradaC1, dataEntradaC2, dataEntradaC3, dataEntradaC4, dataEntradaC5, dataFinalizacao) {
            var card = document.createElement("div");
            card.className = "card";
            card.draggable = true;
            card.id = cardId;

            card.ondragstart = function(event) {
                drag(event);
            };

            var cardContent = document.createElement("div");
            cardContent.className = "card-content";
            cardContent.innerHTML = `
                <table style="width:100%">
                    <tr>
                        <td>
                            <img src="${foto}" style="width: 45px; height: 45px; border-radius: 50%;">
                        </td>
                        <td>
                            <span>${nome}</span></br>
                            <span>${telefone}</span></br>
                            <span>🤖💬: ${descricao}</span></br>
                            <span>⏰: ${status}</span></br>
                        </td>
                    </tr>
                </table>
            `;

            var moveButton = document.createElement("button");
            moveButton.className = "move-button";
            moveButton.textContent = ">";
            moveButton.onclick = function() {
                dropCardInNextColumn(cardId);
            };

            card.appendChild(cardContent);
            card.appendChild(moveButton);

            return card;
        }

        function dropCardInNextColumn(cardId) {
            var currentColumnId = document.getElementById(cardId).parentElement.id;
            var currentIndex = parseInt(currentColumnId.replace("kanbanC", ""));
            var nextColumnIndex = (currentIndex % 5) + 1;
            var nextColumnId = "kanbanC" + nextColumnIndex;
            var target = document.getElementById(nextColumnId);
            if (target.classList.contains("column")) {
                target.appendChild(document.getElementById(cardId));

                // Atualizar o localStorage com as informações da coluna anterior
				
				let columnAntigo = cardId.slice(0, 8);
				cardId = cardId.slice(8,100);
                updateColumnStorage(nextColumnId,columnAntigo,cardId);

            }
        }
    </script>
</body>
</html>
