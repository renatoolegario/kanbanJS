<!DOCTYPE html>
<html>
<head>
    <style>
        .kanban-board {
            display: flex;
        }
        .column {
            flex: 1;
            margin: 10px;
            padding: 10px;
            border: 1px solid #ccc;
            background-color: #f9f9f9;
        }
        .card {
            margin: 10px;
            padding: 10px;
            border: 1px solid #333;
            background-color: #fff;
            cursor: grab;
            display: flex;
            flex-direction: column;
        }
        .column-title {
            font-weight: bold;
        }
        .move-button {
            background-color: #007bff;
            color: #fff;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
        }
        .card-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 10px;
            border-top: 1px solid #ccc;
        }
    </style>
</head>
<body>
    <div class="kanban-board">
        <div class="column" id="kanbanC1" ondrop="drop(event, 'kanbanC1')" ondragover="allowDrop(event)">
            <h2 class="column-title">
                <input type="text" id="titleC1" value="kanbanC1" oninput="changeTitle('titleC1')">
            </h2>
        </div>
        <div class="column" id="kanbanC2" ondrop="drop(event, 'kanbanC2')" ondragover="allowDrop(event)">
            <h2 class "column-title">
                <input type="text" id="titleC2" value="kanbanC2" oninput="changeTitle('titleC2')">
            </h2>
        </div>
        <div class="column" id="kanbanC3" ondrop="drop(event, 'kanbanC3')" ondragover="allowDrop(event)">
            <h2 class "column-title">
                <input type="text" id="titleC3" value="kanbanC3" oninput="changeTitle('titleC3')">
            </h2>
        </div>
        <div class="column" id="kanbanC4" ondrop="drop(event, 'kanbanC4')" ondragover="allowDrop(event)">
            <h2 class="column-title">
                <input type="text" id="titleC4" value="kanbanC4" oninput="changeTitle('titleC4')">
            </h2>
        </div>
        <div class="column" id="kanbanC5" ondrop="drop(event, 'kanbanC5')" ondragover="allowDrop(event)">
            <h2 class="column-title">
                <input type="text" id="titleC5" value="kanbanC5" oninput="changeTitle('titleC5')">
            </h2>
        </div>
    </div>

    <script>
        // Fun√ß√£o para verificar e criar as colunas no localStorage
        function verificarColunasNoLocalStorage() {
            for (var i = 1; i <= 5; i++) {
                var columnId = "kanbanC" + i;
                var columnData = localStorage.getItem(columnId);
                var titleColum = "titleC" + i;

                if (!columnData) {
                    // Se a coluna n√£o existe no localStorage, crie-a com valores padr√£o
                    var columnName = columnId;
                    var message = {
                        idImagem: "imagem123",
                        idMensagem: "mensagem456"
                    };
                    var cards = [];
					

                    var columnData = {
                        nome: columnName, // Adicione o nome da coluna aqui
                        mensagem: message,
                        cartoes: cards
                    };

                    // Armazene a nova coluna no localStorage
                    localStorage.setItem(columnId, JSON.stringify(columnData));
                } 
                    // Apenas se a coluna existe, atribua o valor do nome
                 document.getElementById(titleColum).value = JSON.parse(columnData).nome;
				 
				
				  const colum = document.getElementById(columnId);
				  
					var cartoes = JSON.parse(columnData).cartoes;
						for (var j = 0; j < cartoes.length; j++) {
							var card = cartoes[j];
							colum.appendChild(createCard(
								columnId + "card" + (j + 1),
								card.foto,
								card.nome,
								card.telefone,
								card.descricao,
								card.status,
								card.dataEntrada,
								card.dataEntradaC1,
								card.dataEntradaC2,
								card.dataEntradaC3,
								card.dataEntradaC4,
								card.dataEntradaC5,
								card.dataFinalizacao
							));
						}

                
            }
        }

        // Chame a fun√ß√£o para verificar e criar as colunas no localStorage na carga inicial da p√°gina
        verificarColunasNoLocalStorage();

        function allowDrop(event) {
            event.preventDefault();
        }

        function drag(event) {
            event.dataTransfer.setData("text", event.target.id);
        }

        function drop(event, targetColumn) {
            event.preventDefault();
            var data = event.dataTransfer.getData("text");
            var target = document.getElementById(targetColumn);
            if (target.classList.contains("column")) {
                target.appendChild(document.getElementById(data));

                // Atualizar o localStorage com as informa√ß√µes da coluna
                updateColumnStorage(targetColumn,data);
            }
        }

        function changeTitle(titleId) {
            var titleInput = document.getElementById(titleId);
            var columnId = titleId.replace("title", "kanban");
            var newTitle = titleInput.value;

            // Recupere os dados atuais da coluna no localStorage
            var columnData = localStorage.getItem(columnId);

            if (columnData) {
                // Parse dos dados existentes
                columnData = JSON.parse(columnData);

                // Atualize apenas o nome
                columnData.nome = newTitle;

                // Guarde os dados atualizados novamente no localStorage
                localStorage.setItem(columnId, JSON.stringify(columnData));
            }
        }

  
  
  
  
  function updateColumnStorage(colunaAtual, columnAntigo) {
	
	columnAntigo = columnAntigo.slice(0, 8);
	console.log("Esta puxando aqui: Coluna atual: " + colunaAtual + " | Coluna Antiga: " + columnAntigo);
	
	
	
  
}

  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
        // Recuperar informa√ß√µes do localStorage para preencher o kanban
        for (var i = 1; i <= 5; i++) {
            var columnId = "kanbanC" + i;
            var columnData = localStorage.getItem(columnId);
            if (columnData) {
                columnData = JSON.parse(columnData);
                document.getElementById("title" + columnId).value = columnData.nome;
                // Voc√™ pode preencher a mensagem autom√°tica e os cart√µes com os dados armazenados.
            }
        }

        // Adicione cart√µes ao painel com bot√£o de movimenta√ß√£o e informa√ß√µes
        function createCard(cardId, foto, nome, telefone, descricao, status, dataEntrada, dataEntradaC1, dataEntradaC2, dataEntradaC3, dataEntradaC4, dataEntradaC5, dataFinalizacao) {
            var card = document.createElement("div");
            card.className = "card";
            card.draggable = true;
            card.id = cardId;

            card.ondragstart = function(event) {
                drag(event);
            };

            var cardContent = document.createElement("div");
            cardContent.className = "card-content";
            cardContent.innerHTML = `
                <table style="width:100%">
                    <tr>
                        <td>
                            <img src="${foto}" style="width: 45px; height: 45px; border-radius: 50%;">
                        </td>
                        <td>
                            <span>${nome}</span></br>
                            <span>${telefone}</span></br>
                            <span>ü§ñüí¨: ${descricao}</span></br>
                            <span>‚è∞: ${status}</span></br>
                        </td>
                    </tr>
                </table>
            `;

            var moveButton = document.createElement("button");
            moveButton.className = "move-button";
            moveButton.textContent = ">";
            moveButton.onclick = function() {
                dropCardInNextColumn(cardId);
            };

            card.appendChild(cardContent);
            card.appendChild(moveButton);

            return card;
        }

        function dropCardInNextColumn(cardId) {
            var currentColumnId = document.getElementById(cardId).parentElement.id;
            var currentIndex = parseInt(currentColumnId.replace("kanbanC", ""));
            var nextColumnIndex = (currentIndex % 5) + 1;
            var nextColumnId = "kanbanC" + nextColumnIndex;
            var target = document.getElementById(nextColumnId);
            if (target.classList.contains("column")) {
                target.appendChild(document.getElementById(cardId));

                // Atualizar o localStorage com as informa√ß√µes da coluna anterior
                updateColumnStorage(nextColumnId,currentColumnId);

            }
        }
    </script>
</body>
</html>
